<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="style.css">
</head>
<body>
	<div id="app"></div>
	<!--Script references. -->
	<!--Reference the jQuery library. -->
	<script src="Scripts/jquery-1.6.4.min.js"></script>
	<!--Reference the SignalR library. -->
	<script src="Scripts/jquery.signalR-2.1.1.min.js"></script>
	<!--Reference the autogenerated SignalR hub script. -->
	<script src="signalr/hubs"></script>
	<script src="ui.js"></script>
	<script>
		'use strict';

		const node = document.getElementById('app');

		// Update the second argument to `Elm.Main.embed` with your selected API. See
		// the Intro section of the technical assessment documentation for more
		// information:
		// https://technical-assessment.konicaminoltamarketplace.com
		const app = Elm.Main.embed(node, {
			api: 'Client',
			hostname: '',
		});

		//Connection drops after 10 mins of inactivity
		app.ports.startTimer.subscribe((int) => {
			setTimeout(() => {
				app.ports.timeout.send(int);
			}, 10000);
		});
	</script>
	<!--Add script to update the page and receive messages.-->
	<script type="text/javascript">
		$(function () {
			// Declare a proxy to reference the hub.
			var signalrHub = $.connection.signalRHub;

			// Create a function that the hub can call to broadcast messages.
			signalrHub.client.broadcastMessage = function (name, message) { console.log(name + '-' + message); };

			// Start the connection.
			$.connection.hub.start().done(function () {
				//Used to send and receive payloads from server
				app.ports.request.subscribe((message) => {
					//messages are received from app as json strings, not objects
					//console.log(message);
					//message = JSON.parse(message);
					console.log(message);

					// Create a function that the hub can call to broadcast messages.
					signalrHub.server.send();
					signalrHub.server.sendMessage(message);
				});

				// Parse the message to determine a response, then respond:
				app.ports.response.send({
					msg: "INITIALIZE",
					//These are the prompts that are displayed back to user's terminal
					body: {
						newLine: null,
						heading: "Player 1",
						message: "Awaiting Player 1's Move"
					}
				});
			});
		});
	</script>
</body>
</html>
